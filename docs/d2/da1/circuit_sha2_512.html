<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- For Mobile Devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta name="generator" content="Doxygen 1.9.1"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <title>Solana In-EVM State Verification</title>
    <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX","output/HTML-CSS"],
    });
    </script>
    <script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../../bootstrap.min.css"/>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link href="../../jquery.smartmenus.bootstrap.css" rel="stylesheet"/>
    <!-- SmartMenus jQuery Plugin -->
    <script type="text/javascript" src="../../jquery.smartmenus.js"></script>
    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript" src="../../jquery.smartmenus.bootstrap.js"></script>
    <!-- highlight.js Syntax Highlighter -->
    <link rel="stylesheet" href="../../darkula.css"/>
    <link href="../../custom.doxygen.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.bootstrap.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <ol class="navbar-brand breadcrumb">
                <li class="first">
                    <a href="https://nil.foundation"><span style="font-family:Menlo, Courier, monospace">=nil;</span>
                        Foundation</a>
                </li>
                <li>
                    <a href="https://crypto3.nil.foundation"><span style="font-family:Menlo, Courier,
                    monospace">=nil;</span> Crypto3</a>
                </li>
                <li>
                    <a href="#page-top"><span style="font-family:Menlo, Courier, monospace">=nil;</span> Solana In-EVM State Verification
                        </a>
                </li>
            </ol>
        </div>
    </div>
</nav>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/daa/circuit_index.html">Circuit Definition</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SHA2-512 Circuit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_manual_circuit_sha2_512"></a> </p>
<h2><a class="anchor" id="autotoc_md11"></a>
Introduction</h2>
<p>SHA2-512 uses the similar logical functions as in <a class="el" href="../../d0/d46/circuit_sha2_256.html">SHA2-256 Circuit</a> which operates on \(64\)-bits words. Thus, each input uses the same range proof which extended to 64-bits.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Range proof</h2>
<p>The Following defines the \(a &lt; 2^{64}\) range proof.</p>
<p>Let \(a = \{ a_0, ..., a_{32} \}\), where \(a_i\) is two bits.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a_{29}\)   </td><td class="markdownTableBodyNone">\(a_{30}\)   </td><td class="markdownTableBodyNone">\(a_{31}\)   </td><td class="markdownTableBodyNone">\(a_{32}\)   </td><td class="markdownTableBodyNone">acc    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a_{25}\)   </td><td class="markdownTableBodyNone">\(a_{26}\)   </td><td class="markdownTableBodyNone">\(a_{27}\)   </td><td class="markdownTableBodyNone">\(a_{28}\)   </td><td class="markdownTableBodyNone">acc    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">...   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 6   </td><td class="markdownTableBodyNone">\(a_4\)   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone">acc    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 7   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">a   </td></tr>
</table>
<p>Range gate constraints:</p>
<p>\(w_{1,i}(w_{1,i}-1)(w_{1,i}-2)(w_{1,i} -3) + w_{2,i}(w_{2,i}-1)(w_{2,i}-2)(w_{2,i} - 3) + w_{3,i}(w_{3,i}-1)(w_{3,i}-2)(w_{3,i} -3) +\\+ w_{4,i}(w_{4,i}-1)(w_{4,i}-2)(w_{4,i} -3)\) <br  />
 \(w_{o,i} = w_{o, i - 1} * 4^4 + w_{4,i}*4^3 + w_{3,i}* 4^2 + w_{2,i} * 4 + w_{1,i}\)</p>
<p>The range proofs are included for each input data block.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Sigma function #1</h2>
<p>The following defines the function \(\sigma_0\), which contains sparse mapping sub-circuit with base \(2\). Let \(a\) be divided to \(a_0, a_1, a_2, ..., a_7\) 8 bits-chunks. The values \(a&#39;_0, a&#39;_1, a&#39;_2,..., a&#39;_7\) are in sparse form, and \(a&#39;\) is a sparse \(a\). We need the following lookup tables:</p>
<ol type="1">
<li><b>SHA-256 NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 8ROT1 64</b>: Read \(a&#39;_0\) to \(r_1\)</li>
<li><b>SHA-256 8SHR7 64</b>: Read \(a&#39;_0\) to \(r_3\)</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">\(a_4\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">a    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone">\(a_4&#39;\)   </td><td class="markdownTableBodyNone">\(\sigma_0\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(r_1\)   </td><td class="markdownTableBodyNone">\(r_2\)   </td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o,j+1} = w_{1,j} + w_{2,j}*2^8 + w_{3,j}*2^{8*2} + w_{4,j}*2^{8*3} + w_{o,j}*2^{8*4} + w_{1,j+2}*2^{8*5} + w_{2,j+2}*2^{8*6} + w_{3,j+2}*2^{8*7}\) \(w_{o,j+2} = w_{2,j+1}*4^{8-1} + w_{3,j+1}*4^{8*2-1} + w_{4,j+1}*4^{8*3 - 1} + w_{4,j+2}*4^{8*4 - 1} + w_{1,j+3}*4^ {8*5 - 1} + w_{2,j+3}*4^{8*6 - 1} +\\+ w_{3,j+3}*4^{8*7 - 1} + w_{1,j+1}*4^{8*7} + w_{2,j+1} + w_{3,j+1}*4^{8} + w_{4, j+1}*4^{8*2} +w_{4,j+2}*4^{8*3} + w_{1,j+3}*4^{8*4} + w_{2,j+3}*4^{8*5} +\\+ w_{3,j+3}*4^{8*6} + w_{2,j+1}*4^{8-7} + w_ {3,j+1}*4^{8*2-7} + w_{4,j+1}*4^{8*3 - 7} + w_{4,j+2}*4^{8*4 - 7} + w_{1,j+3}*4^{8*5 - 7} + w_{2,j+3}*4^{8*6 - 7} +\\+ w_{3,j+3}*4^{8*7 - 7} + w_{4, j+3} + w_{o, j+3}\)</p>
<p>10 plookup constraints</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Sigma function #2</h2>
<p>The following defines the function \(\sigma_1\), which contains sparse mapping sub-circuit with base \(2\). Let \(a\) be divided to \(a_0, a_1, a_2, ..., a_7\) 8 bits-chunks. The values \(a&#39;_0, a&#39;_1, a&#39;_2,..., a&#39;_7\) are in sparse form, and \(a&#39;\) is a sparse \(a\). We need the following lookup tables:</p>
<ol type="1">
<li><b>SHA-256 NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 8ROT3 64</b>: Read \(a&#39;_2\) to \(r_1\)</li>
<li><b>SHA-256 8ROT5 SHR6 64</b>: Read \(a&#39;_7 + a&#39;_0\) to \(r_2\)</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">\(a_4\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">a    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone">\(a_4&#39;\)   </td><td class="markdownTableBodyNone">\(\sigma_1\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(r_1\)   </td><td class="markdownTableBodyNone">\(r_2\)   </td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o,j+1} = w_{1,j} + w_{2,j}*2^8 + w_{3,j}*2^{8*2} + w_{4,j}*2^{8*3} + w_{o,j}*2^{8*4} + w_{1,j+2}*2^{8*5} + w_{2,j+2}*2^{8*6} + w_{3,j+2}*2^{8*7}\) <br  />
 \(w_{o,j+2} = w_{1,j+1}*4^{64 -19} + w_{2,j+1}*4^{64 + (8-19)} + w_{4,j+1}*4^{8*3 - 19} + w_{4,j+2}*4^{8*4 - 19} + w_{1,j+3}*4^{8*5 - 19} + \\\ + w_{2,j+3} * 4^{8*6 - 19} + w_{3,j+3}*4^{8*7 -19} + w_{1,j+1}*4^{64 - 61)} + w_{2, j+1}*4^{64 + (8 -61)} + w_{3,j+1}*4^{64 + (8*2 - 61)} + \\\ + w_{4,j+1}*4^{64 + (8*3- 61)} +w_{4,j+2}*4^{64 + (8*4- 61)} + w_{1,j+3}*4^{64 + (8*5- 61)} + w_{2,j+3}*4^{64 +(8*6- 61)} + w_{2,j+1}*4^{8-6} + \\\ + w_{3,j+1}*4^{8*2-6} + w_{4,j+1} + *4^{8*3 - 6} + w_{4,j+2}*4^{8*4 - 6} + w_{1,j+3}*4^{8*5 - 6} + w_{2,j+3}*4^{8*6 - 6} + w_{3,j+3}*4^{8*7 - 6} + \\\ + w_{4, j+3} + w_{o, j+3}\)</p>
<p>10 plookup constraints</p>
<p>The sparse values \(\sigma_0\) and \(\sigma_1\) have to be normalized. The final addition requires one add gate. Note, that \(a&#39;\) already initialized in the row \(j - 2\). We use <b>SHA256 NORMALIZE2</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">\(acc\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a&#39;_4\)   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(\sigma_i\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a_4\)   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Normalize gate constraints:</p>
<p>\(w_{o,j+1} = w_{4,j+1} * 256^3 + w_{3,j+1}*256^2 + w_{2,j+1}* 256 + w_{1,j+1} + w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+w_{3,j+3}*256^6 + \\\ + w_{4,j+4}* 256^7\) <br  />
 \(w_{o,j} = w_{o, j - 2} - (w_{4,j} * 256^3 + w_{3,j}*256^2 + w_{2,j}* 256 + w_{1,j})\) <br  />
 \(w_{o,j+1} = w_{o,j} - ( w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+ w_{3,j+3}*256^6 + w_{4,j+4}* 256^7)\)</p>
<p>8 plookup constraints</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Sigma function #3</h2>
<p>The following defines the \(\Sigma_0\) function, which contain sparse mapping sub-circuit with base \(2\). Let \(a\) be divided to \(a_0, a_1, a_2,a_3\) 7-bits chunks and \(a_4, a_5, a_6, a_7\) 9 bits-chunks. The values \(a&#39;_0, a&#39;_1, a&#39;_2,..., a&#39;_7\) are in sparse form, and \(a&#39;\) is a sparse \(a\). We need the following lookup tables:</p>
<ol type="1">
<li><b>SHA-256 9NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 7NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 9ROT6 32</b>: Read \(a&#39;_4\) to \(r_2\)</li>
<li><b>SHA-256 9ROT2 32</b>: Read \(a&#39;_5\) to \(r_3\)</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\) \(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\) \(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">\(a_4\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\) \(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">a    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\) \(a_7\)   </td><td class="markdownTableBodyNone">\(a_4&#39;\)   </td><td class="markdownTableBodyNone">\(\Sigma_0\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\) \(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(r_1\)   </td><td class="markdownTableBodyNone">\(r_2\)   </td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o,j+1} = w_{1,j} + w_{2,j}*2^7 + w_{3,j}*2^{7*2} + w_{4,j}*2^{7*3} + w_{o,j}*2^{7*4} + w_{1,j+2}*2^{7*4 + 9} + w_{2,j+2}*2^{7*4 + 9*2} + w_{3,j+2}*2^{7*4 + 9*3}\) <br  />
 \(w_{o,j+2} = w_{4,j+2} + w_{1,j+3}*4^9 + w_{2,j+3}*4^{9*2} + w_{3,j+3}*4^{9*3} + w_{1,j+1}*4^{9*4} + w_{2,j+1}*4^ {9*4+7} + w_{3,j+1}*4^{9*4 +7*2} + \\\ + w_{4,j+1}*4^{9*4 +7*3} + w_{1,j+1}*4^{64 - 34)} + w_{2,j+1}*4^{64 + (7 - 34) } + w_{3,j+1}*4^{64 + (7*2 - 34)} + w_{4,j+1}*4^{64 + (7*3- 34)} + \\\ + w_{1,j+3}*4^{64 + (7*4 + 9 - 34)} + w_{2, j+3}*4^{64 + (7*4 +9 *2 -34)} + w_{3,j+3}*4^{64 +(7*4 + 9*3- 34)} + w_{1,j+1}*4^{64 - 39)} + w_{2,j+1}*4^{64 + (7 - 39)} + \\\ + w_{3,j+1}*4^{64+ (7*2 - 39)} + w_{4,j+1}*4^{64 + (7*3- 39)} +w_{4,j+2}*4^{64 + (7*4- 39)} + w_{2,j+3}*4^ {64 + (7*4 + 9*2 -39)} + w_{3,j+3}*4^{64 +(7*4 + 9*3- 39)} + \\\ + w_{4, j+3} + w_{o, j+3}\)</p>
<p>10 plookup constraints</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Sigma function #4</h2>
<p>The following defines the \(\Sigma_1\) function, which contains sparse mapping sub-circuit with base \(2\). Let \(a\) be divided to \(a_0, a_1, a_2,a_3\) 7-bits chunks and \(a_4, a_5, a_6, a_7\) 9 bits-chunks. The values \(a&#39;_0, a&#39;_1, a&#39;_2,..., a&#39;_7\) are in sparse form, and \(a&#39;\) is a sparse \(a\). We need the following lookup tables:</p>
<ol type="1">
<li><b>SHA-256 9NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 7NORMALIZE2</b>: Read \(a_i\) to \(a&#39;_i\)</li>
<li><b>SHA-256 7ROT4 32</b>: Read \(a&#39;_2\) to \(r_2\)</li>
<li><b>SHA-256 9ROT4 32</b>: Read \(a&#39;_5\) to \(r_3\)</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">\(a_4\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">a    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone">\(a_4&#39;\)   </td><td class="markdownTableBodyNone">\(\Sigma_0\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(r_1\)   </td><td class="markdownTableBodyNone">\(r_2\)   </td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o,j+1} = w_{1,j} + w_{2,j}*2^7 + w_{3,j}*2^{7*2} + w_{4,j}*2^{7*3} + w_{o,j}*2^{7*4} + w_{1,j+2}*2^{7*4 + 9} + w_{2,j+2}*2^{7*4 + 9*2} + w_{3,j+2}*2^{7*4 + 9*3}\) <br  />
 \(w_{o,j+2} = w_{3,j+1} + w_{4,j+1}*7^7 + w_{4,j+2}*7^{7*2} + w_{1,j+3}*7^{7*2+9} + w_{2,j+3}*7^{7*2+9*2} + w_{3, j+3}*7^{9*3 +7*2} + w_{1,j+1}*7^{9*4 +7*2} + \\\ + w_{2,j+1}*7^{9*4 +7*3} + w_{1,j+1}*7^{64 - 18)} + w_{2,j+1}*7^{64 + (7 - 18)} +w_{4,j+1}*7^{64 + (7*4- 18)} + + w_{4,j+2}*7^{64 + (7*4 + 9 - 18)} + \\\ + w_{1,j+3}*7^{64 + (7*4 + 9*2 - 18)} + w_{2,j+3}*7^{64 + (7*4 + 9*3 -18)} + w_{3,j+3}*7^{64 +(7*4 + 9*- 18)} + w_{1,j+1}*7^{64 - 41)} + \\\ + w_{2,j+1}*7^{64 + (7 - 41)} + w_{3,j+1}*7^{64 + (7*2 - 41)} + w_{4,j+1}*7^{64 + (7*3- 41)} + \\\ + w_{4,j+2}*7^{64 + (7*3 + 9 - 41)} + w_{2,j+3}*7^{64 + (7*3 +9*2 -41)} + w_{3,j+3}*7^{64 +(7*3 + 9*3- 41)} + w_{4, j+3} + w_{o, j+3}\)</p>
<p>10 plookup constraints</p>
<p>The sparse values \(\Sigma_0\) and \(\Sigma_1\) have to be normalized. We use <b>SHA256 NORMALIZE7</b> Note, that \(a&#39;\) already initialized in the row \(j - 2\).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">\(a&#39;\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">\(acc\)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a&#39;_4\)   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(\sigma_i\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a_4\)   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Normalize gate constraints:</p>
<p>\(w_{o,j+1} = w_{4,j+1} * 256^3 + w_{3,j+1}*256^2 + w_{2,j+1}* 256 + w_{1,j+1} + w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+w_{3,j+3}*256^6 + w_{4,j+4}* 256^7\) <br  />
 \(w_{o,j} = w_{1,j-3} + w_{2,j-3}*4^7 + w_{3,j-3}*4^{7*2} + + w_{4,j-3}*4^{7*3} + w_{4,j-2}*4^{7*4} + w_{1,j-1}*7^{7*4+9}+ w_{2,j-1}*7^{7*4 + 9*2} + w_{2,j-1}*7^{7*4 + 9*3}\) for maj or ch function. for \(\Sigma_1\) replace 4 with 7 <br  />
 \(w_{o,j} = w_{o, j - 2} - (w_{4,j} * 256^3 + w_{3,j}*256^2 + w_{2,j}* 256 + w_{1,j})\) <br  />
 \(w_{o,j+1} = w_{o,j} - ( w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+ w_{3,j+3}*256^6 + w_{4,j+4}* 256^7)\) <br  />
</p>
<p>8 plookup constraints</p>
<h3><a class="anchor" id="autotoc_md17"></a>
The Maj function</h3>
<p>The following defines the Maj function, which contains sparse mapping sub-circuit with base \(2\) for \(a, b ,c\). Note, that the sparse chunks of \(a\) we already have in \(\Sigma_0\) in the circuit. The variables \(b\) and \(c\) were represented in sparse chunks in the previous rounds or it is public inputs.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j   </td><td class="markdownTableBodyNone">\(a&#39;\)   </td><td class="markdownTableBodyNone">\(b&#39;\)   </td><td class="markdownTableBodyNone">\(c&#39;\)   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">maj   </td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o, j} = w_{1,j} + w_{2, j} + w_{3, j}\)</p>
<p>The sparse values \(maj\) have to be normalized. We use <b>SHA256 MAJ NORMALIZE2</b> Note, that \(maj\) already initialized in the row \(j - 1\).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">\(acc\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a&#39;_4\)   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(maj\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a_4\)   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Normalize gate constraints:</p>
<p>\(w_{o,j+1} = w_{4,j+1} * 256^3 + w_{3,j+1}*256^2 + w_{2,j+1}* 256 + w_{1,j+1} + w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+w_{3,j+3}*256^6 + w_{4,j+4}* 256^7\) <br  />
 \(w_{o,j} = w_{o, j - 1} - (w_{4,j} * 256^3 + w_{3,j}*256^2 + w_{2,j}* 256 + w_{1,j})\) <br  />
 \(w_{o,j+1} = w_{o,j} - ( w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+ w_{3,j+3}*256^6 + w_{4,j+4}* 256^7)\) <br  />
</p>
<p>8 plookup constraints</p>
<p>The final addition requires one add gate.</p>
<h3><a class="anchor" id="autotoc_md18"></a>
The Ch function</h3>
<p>The following defines the Ch function, which contains sparse mapping sub-circuit with base \(2\) for \(e, f ,g\). Note, that \(e\) we already have in the sparse from \(\Sigma_1\) in the circuit. The variables \(f\) and \(g\) were represented in sparse form in the previous rounds or it is public inputs.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">e'   </td><td class="markdownTableBodyNone">f'   </td><td class="markdownTableBodyNone">g'   </td><td class="markdownTableBodyNone">h   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Sparse map gate constraints:</p>
<p>\(w_{o, j} = w_{1,j} + 2*w_{2, j} + 3*w_{3, j}\)\</p>
<p>The sparse values \(ch\) have to be normalized. Note, that \(ch\) already initialized in the row \(j - 1\). We use <b>SHA256 CH NORMALIZE7</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">\(w_1\)   </th><th class="markdownTableHeadNone">\(w_2\)   </th><th class="markdownTableHeadNone">\(w_3\)   </th><th class="markdownTableHeadNone">\(w_4\)   </th><th class="markdownTableHeadNone">\(w_o\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 0   </td><td class="markdownTableBodyNone">\(a&#39;_0\)   </td><td class="markdownTableBodyNone">\(a&#39;_1\)   </td><td class="markdownTableBodyNone">\(a&#39;_2\)   </td><td class="markdownTableBodyNone">\(a&#39;_3\)   </td><td class="markdownTableBodyNone">\(acc\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 1   </td><td class="markdownTableBodyNone">\(a_0\)   </td><td class="markdownTableBodyNone">\(a_1\)   </td><td class="markdownTableBodyNone">\(a_2\)   </td><td class="markdownTableBodyNone">\(a_3\)   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">j + 2   </td><td class="markdownTableBodyNone">\(a&#39;_4\)   </td><td class="markdownTableBodyNone">\(a&#39;_5\)   </td><td class="markdownTableBodyNone">\(a&#39;_6\)   </td><td class="markdownTableBodyNone">\(a&#39;_7\)   </td><td class="markdownTableBodyNone">\(ch\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">j + 3   </td><td class="markdownTableBodyNone">\(a_4\)   </td><td class="markdownTableBodyNone">\(a_5\)   </td><td class="markdownTableBodyNone">\(a_6\)   </td><td class="markdownTableBodyNone">\(a_7\)   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>Normalize gate constraints:</p>
<p>\(w_{o,j+1} = w_{4,j+1} * 256^3 + w_{3,j+1}*256^2 + w_{2,j+1}* 256 + w_{1,j+1} + w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+w_{3,j+3}*256^6 + w_{4,j+4}* 256^7\) <br  />
 \(w_{o,j} = w_{o, j - 1} - (w_{4,j} * 256^3 + w_{3,j}*256^2 + w_{2,j}* 256 + w_{1,j})\) <br  />
 \(w_{o,j+1} = w_{o,j} - ( w_{1,j+3}*256^4 + w_{2,j+3} * 256^5+ w_{3,j+3}*256^6 + w_{4,j+4}* 256^7)\) <br  />
</p>
<p>8 plookup constraints</p>
<p>The final addition requires one add gate.</p>
<p>The updating of variables for new rounds costs 10 add gates.</p>
<p>Producing the final hash value costs two add gates. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/>
<address class="footer"><!--<small>
Generated on Sun Nov 14 2021 21:25:02 for Solana In-EVM State Verification by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small>--></address>
</body>
<script type="text/javascript" src="../../bootstrap.doxygen.js"></script>
</html>
